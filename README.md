# McUsd
Simple [USD](https://graphics.pixar.com/usd/release/index.html) scene geometry with a variety of [UsdPreviewSurface](https://graphics.pixar.com/usd/release/spec_usdpreviewsurface.html) materials applied.

Download this repository and then load the McUsd.usda file in the models directory into your favorite USD file viewer.

## Goals

The overarching goal is to help the community strive to give similar or the same renderings, as possible. Consistent interpretation of this material description benefits us all.

This material test is aimed at a few elements:
* Help people implementing UsdPreviewSurface material viewers, providing some reasonably complex surfaces that can highlight common bugs.
* Give examples in the human-readable USDA format to help understanding.
* Note loose areas of the current specification, in anticipation of these being fully specified in time.
* Show the state of various implementations of UsdPreviewSurface, in order to determine areas where the specification is not yet followed.

You're encouraged to move around the model and render from different viewpoints, to change the lights to suit you (an area where USD will someday have more physical lighting units, making interchange cleaner), and in general modify what you need. The model is first and foremost meant as a aid in testing and debugging UsdPreviewSurfaces.

The two lights included are a sun "DistantLight", Euler angles of rotate around X 235 degrees, Y 325 degrees, intensity 30, width angle 1 degree, and a light "DomeLight" with sRGB texture _domelight.png, Z rotate 270, intensity 6. As noted in "Conclusions", these lights are almost always interpreted differently in different applications, if translated at all.

This model was generated by laying down a few blocks in Classic (Java) Minecraft, then using [Mineways](http://mineways.com) to export the model to USDA format. For the exact export settings, see the top of the McUsd.usda file itself. The [JG-RTX resource pack](https://github.com/jasonjgardner/jg-rtx), released under the Creative Commons Attribution-ShareAlike 4.0 International Public
License, is used at a resolution of 256x256 textures for the surfaces. Textures are of four possible types:
* Albedo/Opacity - sRGB color RGBA file with no suffix
* Normal - linear RGB vector directions in tangent space, mapped from (-1,-1,-1) to (1,1,1), suffix "_n.png"
* Roughness - grayscale roughness mapped to 0.0 (smooth) to 1.0 (rough), suffix "_r.png"
* Metallic - metalness, typically binary, mapped to 0.0 (non-metallic) to 1.0 (metallic), suffix "_m.png"
* Emissive - sRGB emissive color, suffix "_e.png"

Parts of the UsdPreviewSurface specification not tested by this model include the path "useSpecularWorkflow 1", and the clearcoat-related, displacement, and occlusion values.

## Conclusions on UsdPreviewSurface

I'm putting conclusions first, since what follows is an extensive set of tests for a variety of applications.

TODO: Emission does not use physical units, and, as spec'ed, colors cannot be > 1.0. Roughness needs nailing down.

## Application Test Results

What follows are images generated by various rendering systems, for comparison. Note that few images will match perfectly from system to system. Reasons include:
* Lighting is not translated in a compatible manner, or not at all, so is added manually.
* Camera position and orientation not translated.
* The opacityThreshold material attribute is not implemented fully.
* The renderer does not support some reflective materials.
* The renderer does not support emissive materials.
* The renderer supports emissive materials, but the emissive values are too bright/dim.

These various conditions and others will be noted after each rendering, as best as I can determine them. The last problem, emissive material definition, is explained in detail in the "Conclusions" section above.

### Omniverse Create

I focused on [Omniverse Create](https://www.nvidia.com/en-us/omniverse/apps/create/) as the target for this USD test file, as Mineways is a "connector" for the Omniverse system, and Omniverse is free and far along in its rendering of UsdPreviewSurface. Also, full disclosure, I work for NVIDIA.

Load procedure: drag and drop McUsd.usda file into the viewport of Omniverse Create.

There are [a few renderers in Omniverse](https://docs.omniverse.nvidia.com/prod_kit/prod_materials-and-rendering/render-settings_overview.html), along with the hydra renderer Pixar Storm being included as an option. All results are from 

#### Omniverse RTX - Interactive (Path Tracing)

Load procedure: Nothing further. By default, the "RTX - Interactive (Path Tracing)" is used.

This renderer is progressive, shooting more and more frames of rays and blending these results in. Here is the render after around 140 frames or so:

![Omniverse RTX - Interactive (Path Tracing)](/images/ov_path_trace.png "Omniverse RTX - Interactive (Path Tracing)")

#### Omniverse RTX - Real-Time

This renderer includes some ray tracing elements.

Load procedure: with the model loaded, in the upper left corner of the viewport is a light-bulb icon with a renderer name. Choose the "RTX - Real-Time" renderer from this dropdown list.

![Omniverse RTX - Real-Time](/images/ov_real_time.png "Omniverse RTX - Real-Time")

Note simplifications occur, such as opaque shadows for semitransparent objects.

#### Omniverse RTX - Accurate (Iray)

Uses the Iray ray tracer. Here is the render after around 140 frames:

Load procedure: with the model loaded, in the upper left corner of the viewport is a light-bulb icon with a renderer name. Choose the "RTX - Real-Time" renderer from this dropdown list.

![Omniverse RTX - Accurate (Iray)](/images/ov_accurate.png "Omniverse RTX - Accurate (Iray)")

Differences with the interactive version include less color on the semitransparent glass block on the left. Though not obvious, the lava is a bit dimmer. In the "Accurate" render a bit of a noisy caustic can be seen on the grass to the right of the gold block.

#### Omniverse Pixar Storm

Load procedure: with the model loaded, in the upper left corner of the viewport is a light-bulb icon with a renderer name. Choose the "Pixar Storm" renderer from this dropdown list.

![Omniverse Pixar Storm](/images/ov_pixar_storm.png "Omniverse Pixar Storm")

Some clear problems: lights are ignored, opacityThreshold is not implemented for cutout objects, metallic seems to have no effect, etc.

### Sketchfab

Load procedure: upload a zip file of the whole "model" directory to your account. Modifications: the directional light was set to 250 degrees, the camera FOV to 30, and the camera view itself manually adjusted to about match.

The Sketchfab rendering can be [directly examined on their site](https://skfb.ly/oxyUE).

![Sketchfab](/images/sketchfab.png "Sketchfab")

Sketchfab does not translate the camera or lights. It uses rasterization and related techniques for interactive rendering, so giving typical limitations: the lava does not emit light, the glass block does not cast a shadow, true reflections are not generated for shiny surfaces. There are some interesting specular highlights on the glass block that are not visible in the Omniverse renderings.

# Contact
Email [me](http://erichaines.com) at [erich@acm.org](mailto:erich@acm.org).